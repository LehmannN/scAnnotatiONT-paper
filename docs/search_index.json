[["impact-of-discrepant-reference-annotations-on-scrna-seq-analyses.html", "scAnnotatiONT paper 1 Impact of discrepant reference annotations on scRNA-seq analyses 1.1 Discrepancies in reference annotations 1.2 Impact of reference choice on scRNA-seq analyses", " scAnnotatiONT paper Nathalie Lehmann 2021-07-13 1 Impact of discrepant reference annotations on scRNA-seq analyses 1.1 Discrepancies in reference annotations 1.1.1 Define paths echo &quot;export pathRef=&#39;data/raw/references/annotations/ucsc/&#39;&quot; &gt;&gt; .rvars echo &quot;export pathOutput=&#39;output/01-Impact-ref-annotation-scRNA/&#39;&quot; &gt;&gt; .rvars source .rvars mkdir -p $pathRef mkdir -p $pathOutput 1.1.2 Get GTF files source .rvars wget https://hgdownload.soe.ucsc.edu/goldenPath/galGal6/bigZips/genes/galGal6.ensGene.gtf.gz \\ -P $pathRef wget https://hgdownload.soe.ucsc.edu/goldenPath/galGal6/bigZips/genes/galGal6.ncbiRefSeq.gtf.gz \\ -P $pathRef wget https://hgdownload.soe.ucsc.edu/goldenPath/galGal6/bigZips/genes/galGal6.refGene.gtf.gz \\ -P $pathRef gunzip ${pathRef}*.gtf.gz source .rvars echo &quot;export ref1=&#39;${pathRef}galGal6.ensGene.gtf&#39;&quot; &gt;&gt; .rvars echo &quot;export ref2=&#39;${pathRef}galGal6.ncbiRefSeq.gtf&#39;&quot; &gt;&gt; .rvars echo &quot;export ref3=&#39;${pathRef}galGal6.refGene.gtf&#39;&quot; &gt;&gt; .rvars 1.1.3 Basic stats on GTF files 1.1.3.1 Fix GTF RefGene file When running mikado, we found out that some exons overlap. This causes mikado to throw an error such as “start must be less than end,” and it stops running. We use gffread -T to fix this issue. source .rvars gffread -T $ref3 &gt; ${ref3%.*}_fixed.gtf sed -i &#39;/ref3/c\\&#39; .rvars echo &quot;export ref3=&#39;${ref3%.*}_fixed.gtf&#39;&quot; &gt;&gt; .rvars source .rvars echo $ref3 ## data/raw/references/annotations/ucsc/galGal6.refGene_fixed.gtf 1.1.3.2 Infer genes from GTF files This step will both infer “gene” feature in the annotation files and convert GTF format to GFF3. Without this step, we would end up with only CDS, transcript, exons features. # Make sure gffread version is &gt;= v0.12.1 source .rvars echo &#39;,genes,transcripts&#39; &gt; ${pathOutput}counts_table.csv for gtf in $ref{1..3} do echo $gtf filename=$(basename -- &quot;$gtf&quot;) # Create GFF3 with all features / only genes / only transcripts gffread -E --keep-genes $gtf -o- &gt; ${pathRef}${filename%.*}.gff3 awk &#39;$3~/gene/&#39; ${pathRef}${filename%.*}.gff3 &gt; ${pathRef}${filename%.*}_genes.gff3 awk &#39;$3~/transcript/&#39; ${pathRef}${filename%.*}.gff3 &gt; ${pathRef}${filename%.*}_transcripts.gff3 # Save count results (number of genes and transcripts in each annotation) echo $filename | tr &#39;\\n&#39; &#39;,&#39; &gt;&gt; ${pathOutput}counts_table.csv wc -l ${pathRef}${filename%.*}_genes.gff3 | cut -d&#39; &#39; -f1 | tr &#39;\\n&#39; &#39;,&#39; &gt;&gt; ${pathOutput}counts_table.csv wc -l ${pathRef}${filename%.*}_transcripts.gff3 | cut -d&#39; &#39; -f1 &gt;&gt; ${pathOutput}counts_table.csv done 1.1.3.3 Run mikado stats source .rvars sed -i &#39;/pathOutput/c\\&#39; .rvars echo &quot;export pathOutput=&#39;output/01-Impact-ref-annotation-scRNA/mikado_stats/&#39;&quot; &gt;&gt; .rvars source .rvars echo $pathOutput mkdir -p $pathOutput ## output/01-Impact-ref-annotation-scRNA/mikado_stats/ source .rvars for gtf in $ref{1..3} do echo $gtf filename=$(basename -- &quot;$gtf&quot;) mikado util stats $gtf ${pathOutput}${filename%.*}_stats.tsv done asm_collect.py ${pathOutput}*_stats.tsv &gt; ${pathOutput}main_stats.tsv 1.1.4 Comparison with GffCompare source .rvars sed -i &#39;/pathOutput/c\\&#39; .rvars echo &quot;export pathOutput=&#39;output/01-Impact-ref-annotation-scRNA/gffcompare/&#39;&quot; &gt;&gt; .rvars source .rvars echo $pathOutput mkdir -p $pathOutput ## output/01-Impact-ref-annotation-scRNA/gffcompare/ source .rvars gffcompare -r $ref1 -o ${pathOutput}gffcmp_ensGene_ncbiRefSeq $ref2 gffcompare -r $ref1 -o ${pathOutput}gffcmp_ensGene_refGene $ref3 gffcompare -r $ref2 -o ${pathOutput}gffcmp_ncbiRefSeq_ensGene $ref1 gffcompare -r $ref2 -o ${pathOutput}gffcmp_ncbiRefSeq_refGene $ref3 gffcompare -r $ref3 -o ${pathOutput}gffcmp_refGene_ncbiRefSeq $ref2 gffcompare -r $ref3 -o ${pathOutput}gffcmp_refGene_ensGene $ref1 1.1.4.1 Make GffCompare results machine readable src/utilities/make_gffcmp_stats_readable.sh 1.1.5 Venn Diagrams All Venn diagrams are produced via Intervene. This tool is based on bedtools interset. Euler diagrams are obtained with eulerr. 1.1.5.1 Gene level source .rvars sed -i &#39;/pathOutput/c\\&#39; .rvars echo &quot;export pathOutput=&#39;output/01-Impact-ref-annotation-scRNA/venn_diagrams/genes/&#39;&quot; &gt;&gt; .vars source .rvars mkdir -p $pathOutput source .rvars echo &quot;export genesGff1=&#39;${pathRef}galGal6.ensGene_genes.gff3&#39;&quot; &gt;&gt; .rvars echo &quot;export genesGff2=&#39;${pathRef}galGal6.ncbiRefSeq_genes.gff3&#39;&quot; &gt;&gt; .rvars echo &quot;export genesGff3=&#39;${pathRef}galGal6.refGene_fixed_genes.gff3&#39;&quot; &gt;&gt; .rvars source .rvars echo $genesGff1 echo $genesGff2 echo $genesGff3 intervene venn -i $genesGff1 $genesGff2 $genesGff3 \\ --figtype png \\ --save-overlaps \\ --bedtools-options f=0.5,r,s \\ --output ${pathOutput} wc -l ${pathOutput}sets/*.bed | \\ awk -v OFS=&quot;\\t&quot; &#39;$1=$1&#39; &gt; ${pathOutput}venn_counts.tsv ## data/raw/references/annotations/ucsc/galGal6.ensGene_genes.gff3 ## data/raw/references/annotations/ucsc/galGal6.ncbiRefSeq_genes.gff3 ## data/raw/references/annotations/ucsc/galGal6.refGene_fixed_genes.gff3 ## usage: intervene venn [options] ## intervene &lt;subcommand&gt; [options] venn: error: argument -o/--output: expected one argument ## wc: &#39;sets/*.bed&#39;: Aucun fichier ou dossier de ce type venn_intersect &lt;- euler(c(&quot;refGene&quot; = 248, &quot;ncbiRefSeq&quot; = 8555, &quot;Ensembl&quot; = 9004, &quot;ncbiRefSeq&amp;Ensembl&quot; = 8927, &quot;ncbiRefSeq&amp;refGene&quot; = 253, &quot;Ensembl&amp;refGene&quot; = 376, &quot;ncbiRefSeq&amp;Ensembl&amp;refGene&quot; = 6049)) plot(venn_intersect, quantities = list(type = c(&quot;percent&quot;, &quot;counts&quot;), col = c(&quot;black&quot;, &quot;black&quot;, &quot;white&quot;), fontsize = 15), labels = list(col = c(&quot;black&quot;, &quot;black&quot;, &quot;white&quot;), fontsize = 20), edges = list(col = &quot;white&quot;, lex = 2), fills = c(&quot;limegreen&quot;, &quot;darkgoldenrod1&quot;, &quot;dodgerblue&quot;), legend = list(side = &quot;right&quot;)) plot(venn_intersect, quantities = list(type = c(&quot;percent&quot;, &quot;counts&quot;), col = c(&quot;black&quot;, &quot;black&quot;, &quot;black&quot;), fontsize = 15), labels = list(col = c(&quot;black&quot;, &quot;black&quot;, &quot;black&quot;), fontsize = 20), edges = list(col = &quot;white&quot;, lex = 2), legend = list(side = &quot;right&quot;)) 1.1.5.2 Transcript level source .rvars sed -i &#39;/pathOutput/c\\&#39; .rvars echo &quot;export pathOutput=&#39;output/01-Impact-ref-annotation-scRNA/venn_diagrams/transcripts/&#39;&quot; &gt;&gt; .rvars source .rvars mkdir -p $pathOutput source .rvars echo &quot;export trxGff1=&#39;${pathRef}galGal6.ensGene_transcripts.gff3&#39;&quot; &gt;&gt; .rvars echo &quot;export trxGff2=&#39;${pathRef}galGal6.ncbiRefSeq_transcripts.gff3&#39;&quot; &gt;&gt; .rvars echo &quot;export trxGff3=&#39;${pathRef}galGal6.refGene_fixed_transcripts.gff3&#39;&quot; &gt;&gt; .rvars source .rvars intervene venn --i $trxGff1 $trxGff2 $trxGff3 \\ --figtype png \\ --save-overlaps \\ --bedtools-options f=0.5,r,s \\ --output ${pathOutput} wc -l ${pathOutput}sets/*.bed | \\ awk -v OFS=&quot;\\t&quot; &#39;$1=$1&#39; &gt; ${pathOutput}venn_counts.tsv ## ## Generating a 3-way &quot;venn&quot; diagram. Please wait... ## ## ## Done! Please check your results @ output/01-Impact-ref-annotation-scRNA/venn_diagrams/transcripts/. ## Thank you for using Intervene! path_output &lt;- &quot;output/01-Impact-ref-annotation-scRNA/venn_diagrams/transcripts/&quot; venn_counts &lt;- read.table(file = paste0(path_output, &#39;venn_counts.tsv&#39;), header = FALSE, col.names = c(&#39;count&#39;, &#39;filePath&#39;), sep = &#39;\\t&#39;) strX &lt;- strsplit(x = venn_counts[1,2], split = &#39;/&#39;)[[1]] #venn_counts %&gt;% mutate(fileName = strsplit(x = filePath, split = &#39;/&#39;))[[1]][length(strX)] venn_intersect &lt;- euler(c(&quot;refGene&quot; = 68, &quot;ncbiRefSeq&quot; = 15647, &quot;Ensembl&quot; = 12567, &quot;ncbiRefSeq&amp;Ensembl&quot; = 16141, &quot;ncbiRefSeq&amp;refGene&quot; = 377, &quot;Ensembl&amp;refGene&quot; = 192, &quot;ncbiRefSeq&amp;Ensembl&amp;refGene&quot; = 10388)) plot(venn_intersect, quantities = list(type = c(&quot;percent&quot;, &quot;counts&quot;), col = c(&quot;black&quot;, &quot;black&quot;, &quot;white&quot;), fontsize = 15), labels = list(col = c(&quot;black&quot;, &quot;black&quot;, &quot;white&quot;), fontsize = 20), edges = list(col = &quot;white&quot;, lex = 2), fills = c(&quot;limegreen&quot;, &quot;darkgoldenrod1&quot;, &quot;dodgerblue&quot;), legend = list(side = &quot;right&quot;)) plot(venn_intersect, quantities = list(type = c(&quot;percent&quot;, &quot;counts&quot;), col = c(&quot;black&quot;, &quot;black&quot;, &quot;black&quot;), fontsize = 15), labels = list(col = c(&quot;black&quot;, &quot;black&quot;, &quot;black&quot;), fontsize = 20), edges = list(col = &quot;white&quot;, lex = 2), legend = list(side = &quot;right&quot;)) 1.2 Impact of reference choice on scRNA-seq analyses data_seurat &lt;- CreateSeuratObject(counts_wide) run nextflow quantif "],["incomplete-annotations-induce-signal-loss.html", " 2 Incomplete annotations induce signal loss", " 2 Incomplete annotations induce signal loss "],["approaches-to-improve-transcriptome-with-long-reads.html", " 3 Approaches to improve transcriptome with long reads", " 3 Approaches to improve transcriptome with long reads "],["impact-of-re-annotation-on-scrna-seq-analyses.html", " 4 Impact of re-annotation on scRNA-seq analyses", " 4 Impact of re-annotation on scRNA-seq analyses "],["validation-of-novel-genes-with-scrna.html", " 5 Validation of novel genes with scRNA", " 5 Validation of novel genes with scRNA "],["a-tool-and-pipeline-to-improve-annotation-for-scrna-seq-analyses.html", " 6 A tool and pipeline to improve annotation for scRNA-seq analyses", " 6 A tool and pipeline to improve annotation for scRNA-seq analyses "],["session-info.html", " 7 Session info", " 7 Session info sessionInfo() ## R version 4.0.3 (2020-10-10) ## Platform: x86_64-conda-linux-gnu (64-bit) ## Running under: Ubuntu 16.04.4 LTS ## ## Matrix products: default ## BLAS/LAPACK: /import/bc_workspaces/csb/lehmann/conda/envs/scRNA/lib/libopenblasp-r0.3.12.so ## ## locale: ## [1] LC_CTYPE=fr_FR.UTF-8 LC_NUMERIC=C ## [3] LC_TIME=fr_FR.UTF-8 LC_COLLATE=fr_FR.UTF-8 ## [5] LC_MONETARY=fr_FR.UTF-8 LC_MESSAGES=fr_FR.UTF-8 ## [7] LC_PAPER=fr_FR.UTF-8 LC_NAME=C ## [9] LC_ADDRESS=C LC_TELEPHONE=C ## [11] LC_MEASUREMENT=fr_FR.UTF-8 LC_IDENTIFICATION=C ## ## attached base packages: ## [1] stats graphics grDevices utils datasets methods base ## ## other attached packages: ## [1] eulerr_6.1.0 dplyr_1.0.5 bookdown_0.22 knitr_1.33 ## ## loaded via a namespace (and not attached): ## [1] Rcpp_1.0.6 highr_0.8 bslib_0.2.4 compiler_4.0.3 ## [5] pillar_1.6.0 jquerylib_0.1.3 tools_4.0.3 digest_0.6.27 ## [9] jsonlite_1.7.2 evaluate_0.14 lifecycle_1.0.0 tibble_3.1.0 ## [13] pkgconfig_2.0.3 rlang_0.4.10 DBI_1.1.1 rstudioapi_0.13 ## [17] yaml_2.2.1 xfun_0.22 stringr_1.4.0 generics_0.1.0 ## [21] vctrs_0.3.7 sass_0.3.1 grid_4.0.3 tidyselect_1.1.0 ## [25] glue_1.4.2 R6_2.5.0 fansi_0.4.2 rmarkdown_2.7 ## [29] polyclip_1.10-0 purrr_0.3.4 polylabelr_0.2.0 magrittr_2.0.1 ## [33] ellipsis_0.3.1 htmltools_0.5.1.1 assertthat_0.2.1 utf8_1.2.1 ## [37] stringi_1.5.3 crayon_1.4.1 "]]
